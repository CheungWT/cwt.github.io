<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTR东铁线时刻表采集系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-train"></i> MTR东铁线时刻表采集系统</h1>
            <p>记录和分析东铁线全天运行时刻表</p>
        </div>
    </header>

    <main class="container">
        <section class="dashboard">
            <div class="stats-card">
                <div class="stat">
                    <h3>总记录数</h3>
                    <p id="total-records">0</p>
                </div>
                <div class="stat">
                    <h3>车站数量</h3>
                    <p>{{ stations|length }}</p>
                </div>
                <div class="stat">
                    <h3>最后更新</h3>
                    <p id="last-update">--</p>
                </div>
            </div>
        </section>

        <section class="actions">
            <h2><i class="fas fa-play-circle"></i> 采集操作</h2>
            <button id="collect-btn" class="btn primary">
                <i class="fas fa-sync-alt"></i> 采集所有车站数据
            </button>
            <p class="hint">采集过程大约需要1-2分钟，请耐心等待</p>
        </section>

        <section class="collection-progress hidden">
            <h2><i class="fas fa-spinner fa-spin"></i> 正在采集数据...</h2>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-text">
                <span id="progress-text">0%</span>
                <span id="station-status">准备开始...</span>
            </div>
            <div class="station-grid" id="station-grid">
                {% for station in stations %}
                <div class="station-card" id="station-{{ station }}">
                    <div class="station-name">{{ station }}</div>
                    <div class="station-status">等待</div>
                </div>
                {% endfor %}
            </div>
        </section>

        <section class="results hidden">
            <h2><i class="fas fa-check-circle"></i> 采集结果</h2>
            <div class="result-summary">
                <p>开始时间: <span id="result-start">--</span></p>
                <p>结束时间: <span id="result-end">--</span></p>
                <p>采集车站: <span id="result-stations">0</span></p>
                <p>新增记录: <span id="result-records">0</span></p>
            </div>
            <button id="view-history-btn" class="btn secondary">
                <i class="fas fa-history"></i> 查看采集历史
            </button>
        </section>

        <section class="history">
            <h2><i class="fas fa-history"></i> 最近采集历史</h2>
            <div class="history-table-container">
                <table id="history-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>开始时间</th>
                            <th>结束时间</th>
                            <th>车站数</th>
                            <th>记录数</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in history %}
                        <tr>
                            <td>{{ entry.id }}</td>
                            <td>{{ entry.start_time }}</td>
                            <td>{{ entry.end_time or '--' }}</td>
                            <td>{{ entry.stations_count or '--' }}</td>
                            <td>{{ entry.records_count or '--' }}</td>
                            <td>
                                <span class="status-badge {{ 'completed' if entry.status == 'completed' else 'in-progress' }}">
                                    {{ entry.status }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <section class="station-stats">
            <h2><i class="fas fa-chart-bar"></i> 车站数据统计</h2>
            <div class="stats-chart-container">
                <canvas id="station-chart"></canvas>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>© 2025 MTR东铁线时刻表采集系统 | 数据来源: 香港政府实时数据API</p>
            <p>此系统仅用于技术演示目的</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
